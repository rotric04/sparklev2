<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Sparkle 3.0</title>
<meta name="color-scheme" content="dark">
<meta name="description" content="Sparkle 3.0 — Freshers × Farewell party. Countdown until Phase 1 registration opens. Play the mini-game and share your score.">
<style>
  :root{
    --max:980px;
    --radius:14px;
    --muted: rgba(255,255,255,0.78);
    --accentA:#9b6bff;
    --accentB:#6da6ff;
    --bg:#06040a;
    --panel-bg: rgba(8,6,14,0.66);
    --soft: cubic-bezier(.2,.9,.2,1);
    --envelope-inner-start: #fff7ec;
    --envelope-inner-end: #fff0f6;
    --ribbon-dark: #7b4cff;
    --ribbon-light: #8fd1ff;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:#fff;background:var(--bg);-webkit-font-smoothing:antialiased}
  *{box-sizing:border-box}
  a{color:inherit;text-decoration:none}
  button{font:inherit;cursor:pointer;border:0}

  /* background */
  .theme-bg{position:fixed;inset:0;background-image:linear-gradient(180deg,#050017,#070014);z-index:0}
  .bg-accent{position:fixed;inset:-20% -20% -20% -20%;background:linear-gradient(120deg, rgba(155,107,255,0.10), rgba(109,166,255,0.10));filter:blur(68px);z-index:0;pointer-events:none}

  /* container */
  .wrap{position:relative;z-index:2;max-width:var(--max);margin:36px auto;padding:20px;min-height:100vh;display:flex;align-items:center;justify-content:center}
  .panel{width:100%;background:var(--panel-bg);border-radius:var(--radius);padding:22px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 80px rgba(0,0,0,0.6);backdrop-filter: blur(6px);opacity:0;transform:translateY(10px) scale(.995);transition:opacity .48s var(--soft), transform .48s var(--soft);display:grid;gap:12px;align-items:center;justify-items:center}

  /* intro */
  #introLayer{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,0.46), rgba(0,0,0,0.64));padding:env(safe-area-inset-top) 12px env(safe-area-inset-bottom);-webkit-tap-highlight-color:transparent}
  .envelope-popup{width:100%;max-width:720px;border-radius:14px;box-shadow:0 30px 80px rgba(0,0,0,0.6);background:linear-gradient(180deg,#0b0610,#0f0816);border:1px solid rgba(255,255,255,0.04);color:#fff;overflow:hidden}
  .envelope-scroll{overflow:auto;max-height:calc(100vh - 120px);-webkit-overflow-scrolling:touch;padding:18px}
  .row{display:flex;gap:16px;align-items:center}
  .envVisual{min-width:86px;width:22%;max-width:140px;border-radius:12px;background:linear-gradient(180deg,var(--envelope-inner-start),var(--envelope-inner-end));box-shadow:inset 0 -10px 24px rgba(0,0,0,0.04),0 18px 40px rgba(30,10,80,0.18);position:relative;perspective:700px;flex-shrink:0;display:flex;align-items:center;justify-content:center;padding:10px;overflow:visible;transition:transform .48s var(--soft)}
  .envFlap{position:absolute;left:6%;top:2%;width:88%;height:50%;background:linear-gradient(180deg,var(--accentA),var(--accentB));border-radius:10px;transform-origin:center top;transition:transform .52s var(--soft);box-shadow:0 8px 20px rgba(80,40,160,0.12)}
  .envBodyInner{position:relative;padding:8px;border-radius:8px;background:linear-gradient(180deg,var(--envelope-inner-start),var(--envelope-inner-end));color:#07101a;font-weight:700;font-size:16px;z-index:2;text-align:center;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.02)}

  .ribbon-wrap{position:relative;height:0}
  .ribbon{position:absolute;width:68px;height:140px;border-radius:10px;top:6px;box-shadow:0 18px 40px rgba(0,0,0,0.12);transform-origin:center;display:block}
  .ribbon.left{left:-38px;transform:rotate(-10deg); background: linear-gradient(180deg,var(--ribbon-dark),var(--ribbon-light));}
  .ribbon.right{right:-38px;transform:rotate(10deg); background: linear-gradient(180deg,var(--ribbon-light),var(--ribbon-dark));}
  .ribbon::after{content:'';position:absolute;left:0;top:0;width:100%;height:100%;border-radius:10px;box-shadow:inset -10px 0 18px rgba(0,0,0,0.12);transform:skewX(8deg) translateX(-6px);opacity:0.9}

  .envelope-wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:1020;pointer-events:none}
  .envelope-dot{width:260px;height:160px;transform-style:preserve-3d;transition:transform .42s var(--soft),opacity .36s var(--soft)}
  .envelope-dot.enter{animation:dropIn 900ms cubic-bezier(.2,.85,.2,1) forwards}
  @keyframes dropIn{0%{transform:translateY(-520px) rotateX(12deg) scale(.9);opacity:0}60%{transform:translateY(18px) rotateX(6deg) scale(1.02);opacity:1}100%{transform:translateY(0) rotateX(0deg) scale(1);opacity:1}}

  /* full letter */
  #fullLetter{position:fixed;inset:0;z-index:1100;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(6,4,10,0.98), rgba(8,6,14,0.98));padding:env(safe-area-inset-top) 12px env(safe-area-inset-bottom);-webkit-overflow-scrolling:touch}
  .letterCard{width:100%;max-width:920px;background:#f7f7f8;color:#07101a;border-radius:12px;padding:18px;max-height:calc(100vh - 80px);overflow:auto;position:relative;-webkit-overflow-scrolling:touch}
  .letterClose{position:absolute;right:12px;top:12px;background:transparent;border-radius:8px;padding:6px 8px;font-weight:800;color:#6b4bff;border:1px solid rgba(107,75,255,0.12)}
  .letterCard h2{margin:0 0 8px 0}
  .letterCard p{margin:10px 0;line-height:1.6;font-size:15px;color:#2b2f35;text-align:justify}

  /* countdown & actions */
 /* allow horizontal scroll if items overflow, but prefer single-line layout on small screens */
.countdown{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  flex-wrap:nowrap;           /* keep items on a single row */
  overflow-x:auto;            /* allow horizontal scroll when necessary */
  -webkit-overflow-scrolling:touch;
  padding:6px 8px;
}

/* reduce each item size slightly on small screens so more likely to fit on one line */
@media (max-width:440px){
  .countdown-item{ min-width:64px; padding:8px 10px; }
  .countdown-value{ font-size:18px; }
  .countdown-label{ font-size:10px; }
}
  .countdown-item{min-width:84px;padding:10px 12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 36px rgba(30,10,80,0.06);text-align:center}
  .countdown-value{font-size:22px;font-weight:900}
  .countdown-label{font-size:11px;color:var(--muted);margin-top:6px;font-weight:800}
  .actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  .btn{padding:12px 16px;border-radius:12px;border:none;font-weight:900}
  .btn.primary{background:linear-gradient(90deg,var(--accentB),var(--accentA));color:#07101a}
  .btn.ghost{background:opaque;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:800}

  .content-block{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:var(--muted);text-align:justify}

  /* single modal (scrollable, device-friendly) */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(1,1,2,0.88);z-index:1200;padding:12px}
  .modal.show{display:flex}
  .modal-card{
    width:100%;
    max-width:920px;
    background:#07101a;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.04);
    box-shadow:0 30px 80px rgba(0,0,0,0.6);
    max-height:calc(100vh - 40px);
    overflow:hidden;
    display:flex;
    flex-direction:column;
  }
  .modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid rgba(255,255,255,0.04); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);}
  .modal-body{
  /* scrolling */
  overflow:auto;
  -webkit-overflow-scrolling: touch; /* enables momentum scrolling on iOS */
  padding:18px;
  /* allow the body to flex and be scrollable inside modal-card */
  flex: 1 1 auto;
  min-height: 0; /* CRITICAL for flex children to be scrollable on iOS */
  /* keep some space for header/footer so body content is fully visible */
  max-height: calc(90vh - 72px); /* adjust 72px if your header+footer height differs */
}

  .modal-footer{padding:12px 16px;border-top:1px solid rgba(255,255,255,0.04);display:flex;gap:10px;justify-content:flex-end;background:linear-gradient(180deg, transparent, rgba(255,255,255,0.01));}
  .close{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;color:var(--muted);font-weight:700}

  .game-area{position:relative;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));height:320px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .sparkle{position:absolute;width:56px;height:56px;border-radius:50%;background:radial-gradient(circle at 35% 30%, #fff 0%, rgba(255,255,255,0.9) 12%, rgba(155,107,255,0.14) 40%, rgba(124,58,237,0.14) 60%);box-shadow:0 8px 18px rgba(140,80,220,0.25);cursor:pointer;touch-action:manipulation;transition:transform .12s ease, opacity .12s ease}

  @media (max-width:720px){ .letterCard{padding:14px} .game-area{height:260px} .modal-card{max-width:calc(100% - 20px);} }
  @media (max-width:420px){ .envBodyInner{font-size:14px} .envVisual{width:76px} .game-area{height:220px} }
</style>
<script defer src="/_vercel/insights/script.js"></script>
</head>
<body>

<div class="theme-bg" aria-hidden="true"></div>
<div class="bg-accent" aria-hidden="true"></div>

<!-- INTRO LAYER -->
<div id="introLayer" role="dialog" aria-modal="true">
  <div class="envelope-popup" id="envelopePopup" aria-hidden="false">
    <div class="ribbon-wrap" style="position:relative">
      <div class="ribbon left" aria-hidden="true"></div>
      <div class="ribbon right" aria-hidden="true"></div>
    </div>

    <div class="envelope-scroll" id="envelopeScroll">
      <div class="row">
        <div class="envVisual" id="envVisual" aria-hidden="true">
          <div class="envFlap" id="envFlap" aria-hidden="true"></div>
          <div class="envBodyInner">Open me</div>
        </div>

        <div style="flex:1;color:#fff">
          <h3 style="margin:0 0 6px 0;font-size:18px">You have a message from Sparkle 3.0</h3>
          <p style="margin:0 0 12px 0;color:var(--muted);font-size:13px;line-height:1.4">Tap <strong>Open Envelope</strong> to read a short, heartfelt note from the committee. Use Skip to continue to the site for now.</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button id="openEnvelopeBtn" class="btn primary">Open Envelope</button>
            <button id="skipEnvelopeBtn" class="btn ghost">Skip for now</button>
          </div>
        </div>
      </div>

      <p style="margin-top:14px;color:var(--muted);font-size:13px">Tip: on phones the letter opens full-screen and is scrollable. You can open it later from the site menu if you prefer.</p>
    </div>
  </div>

  <!-- envelope transient visual for drop/open -->
  <div class="envelope-wrap" id="envelopeWrap" aria-hidden="true" style="display:none;">
    <div class="envelope-dot" id="envelopeDot" aria-hidden="true">
      <div style="position:absolute;left:0;top:0;width:100%;height:60%;background:linear-gradient(180deg,var(--accentA),var(--accentB));border-radius:10px;"></div>
    </div>
  </div>

  <!-- Full letter overlay -->
  <div id="fullLetter" aria-hidden="true">
    <div class="letterCard" role="document" aria-label="Sparkle 3.0 Letter">
      <button id="letterCloseX" class="letterClose" aria-label="Close letter">Close</button>
      <h2>Letter From Sparkle 3.0 Organizers</h2>
      <p><strong>Dear UVPCE family,</strong></p>
      <p>For two years our campus nights stayed silent. The stages remained empty, the energy never rose, and the stories we should have lived never began. This year, that silence ends. Sparkle 3.0 is not simply a return but a powerful revival built on everything we missed and everything we are ready to feel again. The atmosphere will deepen, the excitement will rise quickly, and the night will stay with you long after it is over. You will be grateful you were here for this moment.</p>
      <p>This evening is created entirely by students for students, driven by passion, commitment, and an understanding that only those who live this campus every day can bring. Every detail has been shaped with intention, and that makes this event something you can trust. The organizers are building an experience that reflects the real pulse of the campus, and the result is a night designed to feel genuine and unforgettable.</p>
      <p>Phase 1 seats are limited, and quietly, they may be the best chance to secure your place before the rush begins. Reserving early ensures that you are not watching the night from the outside but standing inside it as it becomes something everyone will talk about.</p>
      <p>Come ready and come present, because Sparkle 3.0 is prepared to deliver the night we have all been waiting for. The wait has been long, but the return will be worth every moment.</p>
      <p style="margin-top:12px"><strong>With excitement,</strong><br>Sparkle 3.0 Committee</p>

      <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap">
        <button id="joinWaitlist" class="btn primary">Remind me when registration opens</button>
        <button id="closeLetter" class="btn ghost">Continue to site</button>
      </div>
    </div>
  </div>
</div>

<!-- MAIN PANEL -->
<div class="wrap">
  <section id="mainPanel" class="panel" role="main" aria-labelledby="payHead">
    <header>
      <h1 id="payHead">Freshers' x Farewell Party</h1>
      <div class="subtitle" style="color:var(--muted)">Laugh · Enjoy · Vibe</div>
    </header>

    <div style="text-align:center">
      <div class="motto-large" aria-hidden="false" style="font-weight:900;font-size:clamp(30px,6.4vw,64px);line-height:0.98;letter-spacing:2px;background:linear-gradient(90deg,var(--accentA),var(--accentB));-webkit-background-clip:text;background-clip:text;color:transparent">SPARKLE 3.0</div>
      <div class="motto-small" style="font-weight:700;font-size:clamp(13px,2.2vw,16px);color:#fff;margin-top:6px;text-align:center">Welcoming new beginnings · Celebrating golden endings</div>
    </div>

    <div class="countdown" role="status" aria-live="polite" style="margin-top:8px">
      <div class="countdown-item"><div id="days" class="countdown-value">00</div><div class="countdown-label">DAYS</div></div>
      <div class="countdown-item"><div id="hours" class="countdown-value">00</div><div class="countdown-label">HOURS</div></div>
      <div class="countdown-item"><div id="minutes" class="countdown-value">00</div><div class="countdown-label">MINUTES</div></div>
      <div class="countdown-item"><div id="seconds" class="countdown-value">00</div><div class="countdown-label">SECONDS</div></div>
    </div>

    <div class="actions" style="margin-top:8px">
      <button id="regBtn" class="btn primary" disabled>Phase 1 Update: 97 slots left</button>
      <button id="whyBtn" class="btn ghost">Why Sparkle 3.0?</button>
    </div>

    <div class="split" style="display:grid;grid-template-columns:1fr;gap:16px;width:100%;align-items:start;margin-top:12px">
      <div class="about content-block">
        <h3 style="margin:0 0 8px 0;color:#fff">About Sparkle 3.0</h3>
        <p style="margin:0 0 10px 0">
          Sparkle 3.0 is a student-led Freshers × Farewell celebration that brings together new beginnings and fond farewells in one energetic evening. We are curating a balanced program of music, dance, theatrical showcases, and surprise moments designed to create unforgettable memories for everyone who attends.
        </p>

        <h4 style="margin:8px 0 6px 0;color:#fff">What to expect</h4>
        <p style="margin:0 0 10px 0">
          Expect a carefully paced lineup: high-energy musical acts, collaborative performances between batches, student-run stalls, and interactive segments that invite the audience to participate. We are arranging stage lighting, sound, and production with professional-grade attention so the performances feel polished and immersive.
        </p>

        <h4 style="margin:8px 0 6px 0;color:#fff">Why attend</h4>
        <p style="margin:0 0 10px 0">
          Sparkle 3.0 is an opportunity to celebrate community. For juniors, it is the first big campus memory to hold. For seniors, it is a chance to be recognised by peers. For everyone, it is a night to meet new people, cheer for friends, and create stories that last. Being there changes the memory from a message to a moment.
        </p>

        <h4 style="margin:8px 0 6px 0;color:#fff">Tickets and phases</h4>
        <p style="margin:0 0 10px 0">
          Phase 1 offers early access with limited seats and special pricing. Subsequent phases will open with additional inventory at standard pricing. Reserving during Phase 1 is recommended if you want the best seats and the earliest access to special segments.
        </p>

        <h4 style="margin:8px 0 6px 0;color:#fff">Community and conduct</h4>
        <p style="margin:0 0 10px 0">
          Our priority is a safe and respectful environment. Everyone attending is expected to behave respectfully. Harassment or misuse of tickets will result in removal. Organisers reserve the right to verify and revoke tickets in case of misuse.
        </p>

        <h4 style="margin:8px 0 6px 0;color:#fff">Get involved</h4>
        <p style="margin:0 0 6px 0">
          Want to volunteer or perform? Reach out via our Instagram @sparkle.uvpce. Groups are welcome because this is a collaborative student event and we encourage contributions that make the night richer.
        </p>
      </div>
    </div>

    <footer style="margin-top:12px;color:var(--muted);text-align:justify">© Sparkle 3.0 · All times India Standard Time (UTC+05:30)</footer>
  </section>
</div>

<!-- Single scrollable modal (device-friendly) -->
<div id="howModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal-card" role="document" aria-labelledby="howTitle">
    <div class="modal-header">
      <h2 id="howTitle" style="margin:0;color:#fff">Why Sparkle 3.0?</h2>
      <div>
        <button id="closeHow" class="close" aria-label="Close">Close</button>
      </div>
    </div>

    <div class="modal-body">
      <div style="color:var(--muted);margin-bottom:12px">
        Sparkle 3.0 connects batches, honours seniors and welcomes newcomers. Phase 1 seats are limited; follow announcements for phases. Play the mini-game, share your score, and tag @sparkle.uvpce to be featured.
      </div>

      <h3 style="color:#fff;margin-top:8px"><b>Catch the Sparkle</b></h3>
      <div style="display:flex;gap:12px;align-items:center;margin:8px 0 14px 0">
        <div><div class="countdown-value" id="gameScore">0</div><div style="font-size:12px;color:var(--muted)">SCORE</div></div>
        <div><div class="countdown-value" id="gameTime">20s</div><div style="font-size:12px;color:var(--muted)">TIME LEFT</div></div>
        <div><div class="countdown-value" id="gameBest">0</div><div style="font-size:12px;color:var(--muted)">BEST</div></div>
      </div>

      <div id="gameArea" class="game-area" tabindex="0" aria-label="Mini-game area"></div>

      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
        <button id="startGame" class="btn primary">Start Game</button>
        <button id="stopGame" class="btn ghost" disabled>Stop</button>
        <button id="resetBest" class="btn ghost">Reset Best</button>
        <button id="shareBtn" class="btn primary">Share Screenshot</button>
      </div>

      <hr style="border:0;border-top:1px solid rgba(255,255,255,0.04);margin:16px 0">

      <h4 style="color:#fff;margin:0 0 8px 0">Rules</h4>
      <ul style="color:var(--muted);line-height:1.6;margin-top:6px;margin-bottom:12px">
        <li>Tap purple sparkles. Small = 1 point, big = 3 points.</li>
        <li>Round length: 20 seconds.</li>
        <li>Tag <strong>@sparkle.uvpce</strong> on Instagram to be featured — top scores may win passes (organiser verification required).</li>
        <li>Play responsibly — do not use multiple devices to inflate scores. Organisers can verify winners and revoke unfair scores.</li>
      </ul>

      <h4 style="color:#fff;margin-top:12px">Support</h4>
      <p style="color:var(--muted);line-height:1.5">If the game doesn't start on your device try reloading, or use a different browser. For issues DM @sparkle.uvpce on Instagram.</p>
    </div>

    <div class="modal-footer" aria-hidden="true">
      <!-- optional footer actions - left empty intentionally -->
    </div>
  </div>
</div>

<script>
/* CONFIG */
const TARGET_ISO = '2025-12-15T06:30:00+05:30';
const GAME_DURATION = 20;

/* helper */
function safeAdd(el, ev, fn, opts){ if (el) el.addEventListener(ev, fn, opts); }

/* DOM refs */
const openEnvelopeBtn = document.getElementById('openEnvelopeBtn');
const skipEnvelopeBtn = document.getElementById('skipEnvelopeBtn');
const envelopeWrap = document.getElementById('envelopeWrap');
const envelopeDot = document.getElementById('envelopeDot');
const envFlap = document.getElementById('envFlap');
const fullLetter = document.getElementById('fullLetter');
const closeLetterBtn = document.getElementById('closeLetter');
const letterCloseX = document.getElementById('letterCloseX');
const joinWaitlistBtn = document.getElementById('joinWaitlist');
const mainPanel = document.getElementById('mainPanel');

const whyBtn = document.getElementById('whyBtn');
const howModal = document.getElementById('howModal');
const closeHow = document.getElementById('closeHow');
const gameArea = document.getElementById('gameArea');
const startGameBtn = document.getElementById('startGame');
const stopGameBtn = document.getElementById('stopGame');
const resetBestBtn = document.getElementById('resetBest');
const shareBtn = document.getElementById('shareBtn');
const gameScoreEl = document.getElementById('gameScore');
const gameTimeEl = document.getElementById('gameTime');
const gameBestEl = document.getElementById('gameBest');
const regBtn = document.getElementById('regBtn');

/* tiny toast */
function showToast(t){
  const d = document.createElement('div');
  d.textContent = t;
  d.style.cssText = 'position:fixed;left:50%;bottom:12%;transform:translateX(-50%);background:#fff;color:#07101a;padding:8px 12px;border-radius:10px;z-index:9999;font-weight:700';
  document.body.appendChild(d);
  setTimeout(()=> d.remove(), 1600);
}

/* envelope open/drop */
function showEnvelopeDropAndOpen(){
  if (!envelopeWrap || !envelopeDot){
    if (fullLetter){ fullLetter.style.display = 'flex'; fullLetter.setAttribute('aria-hidden','false'); document.documentElement.style.overflow = 'hidden'; }
    return;
  }
  envelopeWrap.style.display = 'flex';
  envelopeDot.classList.remove('enter');
  void envelopeDot.offsetWidth;
  envelopeDot.classList.add('enter');
  setTimeout(()=> {
    if (envFlap) envFlap.style.transform = 'rotateX(-180deg)';
    setTimeout(()=> {
      if (fullLetter){ fullLetter.style.display = 'flex'; fullLetter.setAttribute('aria-hidden','false'); document.documentElement.style.overflow = 'hidden'; }
    }, 520);
  }, 900);
}

/* envelope button handlers */
safeAdd(openEnvelopeBtn, 'click', ()=> {
  const popup = document.getElementById('envelopePopup');
  if (popup) popup.style.display = 'none';
  showEnvelopeDropAndOpen();
}, { once:true, passive:true });

safeAdd(skipEnvelopeBtn, 'click', ()=> {
  const popup = document.getElementById('envelopePopup');
  if (popup) popup.style.display = 'none';
  const introLayer = document.getElementById('introLayer');
  if (introLayer){ introLayer.style.transition = 'opacity .28s ease'; introLayer.style.opacity = '0'; setTimeout(()=> { introLayer.style.display='none'; }, 320); }
  revealMain();
}, { once:true, passive:true });

/* close letter and reveal main UI */
safeAdd(letterCloseX, 'click', closeLetterFlow, { passive:true });
safeAdd(closeLetterBtn, 'click', closeLetterFlow, { passive:true });
function closeLetterFlow(){
  if (fullLetter){ fullLetter.style.display = 'none'; fullLetter.setAttribute('aria-hidden','true'); }
  if (envelopeDot){ envelopeDot.style.transform = 'translateY(-220px) scale(.95) rotateX(6deg)'; envelopeDot.style.opacity = '0'; }
  setTimeout(()=> { if (envelopeWrap) envelopeWrap.style.display = 'none'; document.documentElement.style.overflow = ''; const introLayer = document.getElementById('introLayer'); if (introLayer){ introLayer.style.opacity='0'; setTimeout(()=> introLayer.style.display='none', 360); } revealMain(); }, 420);
}

/* waitlist button */
safeAdd(joinWaitlistBtn, 'click', ()=> { try{ localStorage.setItem('sparkle_remind','1'); }catch(e){} showToast('We will remind you when registration opens. Follow @sparkle.uvpce for updates.'); }, { passive:true });

/* reveal main */
function revealMain(){ if (!mainPanel) return; mainPanel.style.opacity = '1'; mainPanel.style.transform = 'translateY(0)'; }

/* open modal */
safeAdd(whyBtn, 'click', ()=> {
  if (!howModal) return;
  howModal.classList.add('show'); howModal.setAttribute('aria-hidden','false');
  document.documentElement.style.overflow='hidden';
  // ensure modal body scroll starts at top
  const body = howModal.querySelector('.modal-body');
  if (body) body.scrollTop = 0;
}, { passive:true });

/* close modal */
function closeModal(){
  if (!howModal) return;
  howModal.classList.remove('show'); howModal.setAttribute('aria-hidden','true');
  document.documentElement.style.overflow='';
}
safeAdd(closeHow, 'click', closeModal, { passive:true });

/* Prevent backdrop scrolling while allowing modal body scroll on touch devices */
// inside your existing script where you init the modal:
if (howModal) {
  howModal.addEventListener('touchmove', function (e) {
    if (!e.target.closest('.modal-card')) {
      e.preventDefault(); // block background scroll
    }
    // if touch is inside modal-card, allow native scroll
  }, { passive: false });
}


/* COUNTDOWN */
const daysEl = document.getElementById('days'), hoursEl = document.getElementById('hours'),
      minutesEl = document.getElementById('minutes'), secondsEl = document.getElementById('seconds');

const targetTime = new Date(TARGET_ISO).getTime();
const pad = n => String(n).padStart(2,'0');

let lastValues = {d:null,h:null,m:null,s:null};
function updateCountdown(){
  const now = Date.now();
  let diff = targetTime - now;
  if (diff <= 0){
    if (daysEl) daysEl.textContent = '00';
    if (hoursEl) hoursEl.textContent = '00';
    if (minutesEl) minutesEl.textContent = '00';
    if (secondsEl) secondsEl.textContent = '00';
    goLive();
    return;
  }
  const sec = Math.floor(diff/1000);
  const d = Math.floor(sec/86400);
  const h = Math.floor((sec%86400)/3600);
  const m = Math.floor((sec%3600)/60);
  const s = sec % 60;
  if (daysEl && lastValues.d !== d){ daysEl.textContent = pad(d); lastValues.d = d; }
  if (hoursEl && lastValues.h !== h){ hoursEl.textContent = pad(h); lastValues.h = h; }
  if (minutesEl && lastValues.m !== m){ minutesEl.textContent = pad(m); lastValues.m = m; }
  if (secondsEl && lastValues.s !== s){ secondsEl.textContent = pad(s); lastValues.s = s; }
  requestAnimationFrame(updateCountdown);
}
requestAnimationFrame(updateCountdown);

function goLive(){
  if (!regBtn) return;
  regBtn.disabled = false;
  regBtn.textContent = 'Phase 1 Registration is LIVE — Grab your slot';
  regBtn.addEventListener('click', ()=> { window.open('#','_self'); }, { once:true });
}

/* BACKGROUND PARTICLES */
const bgCanvas = document.createElement('canvas');
bgCanvas.style.position = 'fixed';
bgCanvas.style.left = '0';
bgCanvas.style.top = '0';
bgCanvas.style.right = '0';
bgCanvas.style.bottom = '0';
bgCanvas.style.zIndex = '-1';
bgCanvas.style.pointerEvents = 'none';
document.body.appendChild(bgCanvas);
const bgCtx = bgCanvas.getContext('2d');
let bgDPR = Math.max(1, window.devicePixelRatio || 1);
let bgParticles = [];
function resizeBG(){ const w=window.innerWidth, h=window.innerHeight; bgCanvas.width=Math.floor(w*bgDPR); bgCanvas.height=Math.floor(h*bgDPR); bgCanvas.style.width=w+'px'; bgCanvas.style.height=h+'px'; bgCtx.setTransform(bgDPR,0,0,bgDPR,0,0); }
function initBG(){ resizeBG(); const W=window.innerWidth; const N = W < 480 ? 8 : Math.max(18, Math.floor(W/40)); bgParticles = new Array(N).fill(0).map(()=>({ x:Math.random()*window.innerWidth, y:Math.random()*window.innerHeight, vx:(Math.random()-0.5)*0.1, vy:(Math.random()-0.2)*0.02 - 0.01, r:1+Math.random()*5, hue:250+Math.random()*60, alpha:0.06+Math.random()*0.2 })); }
let lastBG = performance.now(), bgRunning = true;
function bgLoop(now){ if(!bgRunning){ lastBG = now; requestAnimationFrame(bgLoop); return; } const dt = Math.min(40, now - lastBG); lastBG = now; bgCtx.clearRect(0,0,window.innerWidth, window.innerHeight); for (let i=0;i<bgParticles.length;i++){ const p = bgParticles[i]; p.x += p.vx * dt; p.y += p.vy * dt; if (p.x < -20) p.x = window.innerWidth + 20; if (p.x > window.innerWidth + 20) p.x = -20; if (p.y < -40) p.y = window.innerHeight + 40; if (p.y > window.innerHeight + 40) p.y = -40; const g = bgCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*10); g.addColorStop(0, `hsla(${p.hue},85%,70%,${Math.min(1,p.alpha*2)})`); g.addColorStop(0.35, `hsla(${p.hue},85%,70%,${p.alpha})`); g.addColorStop(1, `hsla(${p.hue},85%,70%,0)`); bgCtx.fillStyle = g; bgCtx.fillRect(Math.round(p.x - p.r*6), Math.round(p.y - p.r*6), p.r*12, p.r*12); } requestAnimationFrame(bgLoop); }
window.addEventListener('resize', ()=> { resizeBG(); initBG(); }, { passive:true }); document.addEventListener('visibilitychange', ()=> { bgRunning = !document.hidden; }); initBG(); requestAnimationFrame(bgLoop);

/* MINI-GAME (same tested logic) */
let game = { running:false, score:0, best: Number(localStorage.getItem('sparkle_best') || 0), timeLeft: GAME_DURATION, raf:null, lastSpawn:0, spawnInterval:600 };
if (gameBestEl) gameBestEl.textContent = game.best;

safeAdd(whyBtn, 'click', ()=> { if (!howModal) return; howModal.classList.add('show'); howModal.setAttribute('aria-hidden','false'); document.documentElement.style.overflow='hidden'; adaptGameArea(); }, { passive:true });
safeAdd(closeHow, 'click', ()=> { if (!howModal) return; howModal.classList.remove('show'); howModal.setAttribute('aria-hidden','true'); document.documentElement.style.overflow=''; stopGame(true); }, { passive:true });

function adaptGameArea(){ document.querySelectorAll('.sparkle').forEach(s=> s.remove()); }
function spawnSparkle(big=false){ if (!gameArea) return; const el=document.createElement('div'); el.className='sparkle'; const size = big ? (window.innerWidth<520?56:72) : (window.innerWidth<520?48:56); const areaW=Math.max(160, gameArea.clientWidth - size - 8); const areaH=Math.max(120, gameArea.clientHeight - size - 8); const x=Math.floor(Math.random()*areaW)+4; const y=Math.floor(Math.random()*areaH)+4; el.style.left=x+'px'; el.style.top=y+'px'; el.style.width=size+'px'; el.style.height=size+'px'; el.dataset.value = big ? '3' : '1'; el.addEventListener('pointerdown', function onHit(e){ e.stopPropagation(); const v=Number(el.dataset.value||1); game.score += v; if (gameScoreEl) gameScoreEl.textContent = game.score; el.style.transition='transform 160ms ease, opacity 160ms ease'; el.style.transform='scale(1.6)'; el.style.opacity='0'; setTimeout(()=> el.remove(), 160); }, { once:true, passive:true }); gameArea.appendChild(el); setTimeout(()=> { if (el.isConnected) el.remove(); }, 1500 + Math.random()*900); }

function gameLoop(now){ if (!game.running){ game.raf=null; return; } if (!game.lastTS){ game.lastTS = now; game.lastSpawn = now; } game.lastTS = now; const targetInterval = Math.max(220, 700 - Math.min(500, game.score*12)); if (now - game.lastSpawn > targetInterval){ const count = Math.random() < 0.25 ? 2 : 1; for (let i=0;i<count;i++) spawnSparkle(Math.random() < 0.14); game.lastSpawn = now; } if (!game._tickT || now - game._tickT >= 1000){ game._tickT = now; game.timeLeft -= 1; if (gameTimeEl) gameTimeEl.textContent = game.timeLeft + 's'; if (game.timeLeft <= 0){ endGame(); return; } } game.raf = requestAnimationFrame(gameLoop); }

function startGame(){ if (game.running) return; game.running = true; game.score = 0; game.timeLeft = GAME_DURATION; if (gameScoreEl) gameScoreEl.textContent = '0'; if (gameTimeEl) gameTimeEl.textContent = GAME_DURATION + 's'; if (startGameBtn) startGameBtn.disabled = true; if (stopGameBtn) stopGameBtn.disabled = false; if (shareBtn) shareBtn.disabled = true; adaptGameArea(); spawnSparkle(); if (Math.random() > 0.6) spawnSparkle(true); game.lastTS = performance.now(); game.lastSpawn = performance.now(); game.raf = requestAnimationFrame(gameLoop); }

function stopGame(clean=false){ game.running = false; if (game.raf) cancelAnimationFrame(game.raf); game.raf = null; if (startGameBtn) startGameBtn.disabled = false; if (stopGameBtn) stopGameBtn.disabled = true; if (shareBtn) shareBtn.disabled = false; document.querySelectorAll('.sparkle').forEach(s=> s.remove()); if (clean) { } }

function endGame(){ stopGame(); if (game.score > game.best){ game.best = game.score; localStorage.setItem('sparkle_best', String(game.best)); if (gameBestEl) gameBestEl.textContent = game.best; showToast(`New personal best: ${game.best}`); } else { showToast(`Score: ${game.score}`); } }

safeAdd(startGameBtn, 'click', startGame, { passive:true });
safeAdd(stopGameBtn, 'click', ()=> stopGame(false), { passive:true });
safeAdd(resetBestBtn, 'click', ()=> { const ok = confirm('Reset personal best on this device? This clears stored best locally.'); if (!ok) return; localStorage.removeItem('sparkle_best'); game.best = 0; if (gameBestEl) gameBestEl.textContent = game.best; alert('Personal best cleared on this device.'); }, { passive:true });

/* share helpers */
async function createShareImage(score){ const w=900,h=560; const c=document.createElement('canvas'); const r=window.devicePixelRatio||1; c.width=w*r; c.height=h*r; c.style.width=w+'px'; c.style.height=h+'px'; const g=c.getContext('2d'); g.scale(r,r); const grad=g.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#6b4bff'); grad.addColorStop(1,'#b084ff'); g.fillStyle=grad; g.fillRect(0,0,w,h); g.fillStyle='rgba(255,255,255,0.95)'; g.beginPath(); g.ellipse(120,110,72,72,0,0,Math.PI*2); g.fill(); g.fillStyle='#fff'; g.font='700 44px Inter, sans-serif'; g.fillText('SPARKLE 3.0',220,88); g.font='600 18px Inter, sans-serif'; g.fillText('Welcoming new beginnings,',220,118); g.fillText('Celebrating golden endings',220,144); g.fillStyle='rgba(0,0,0,0.18)'; g.fillRect(w-260,h-160,220,120); g.fillStyle='#fff'; g.font='900 56px Inter, sans-serif'; g.textAlign='center'; g.fillText(String(score),w-150,h-100); g.font='600 14px Inter, sans-serif'; g.fillText('Catch the Sparkle — Sparkle 3.0', w-150, h-70); g.textAlign='left'; g.font='500 12px Inter, sans-serif'; g.fillStyle='rgba(255,255,255,0.92)'; g.fillText('@sparkle.uvpce • Freshers × Farewell',24,h-18); return new Promise(res => c.toBlob(blob => res(blob), 'image/png', 0.92)); }

async function shareScreenshot(){ const score = game.score || 0; if (score === 0){ alert('Play a round first — get a score to share!'); return; } try{ const blob = await createShareImage(score); if (!blob){ alert('Could not create share image. Please screenshot and tag @sparkle.uvpce.'); return; } const file = new File([blob], `sparkle_score_${score}.png`, { type:'image/png' }); if (navigator.canShare && navigator.canShare({ files: [file] })) { await navigator.share({ files:[file], title:`Sparkle 3.0 — My Score ${score}`, text:`I scored ${score} in the Catch the Sparkle mini-game! Tag @sparkle.uvpce` }); alert('Share sheet opened — tag @sparkle.uvpce on Instagram to be featured.'); return; } if (navigator.share) { await navigator.share({ title:`Sparkle 3.0 — My Score ${score}`, text:`I scored ${score} in the Catch the Sparkle mini-game! Tag @sparkle.uvpce` }); alert('Shared. Tag @sparkle.uvpce on Instagram to be featured.'); return; } if (navigator.clipboard && navigator.clipboard.write) { try { const item = new ClipboardItem({ [blob.type]: blob }); await navigator.clipboard.write([item]); alert('Score image copied to clipboard. Paste into Instagram or your gallery and tag @sparkle.uvpce.'); return; } catch(e){} } try { await navigator.clipboard.writeText(`I scored ${score} in the Catch the Sparkle mini-game! Tag @sparkle.uvpce`); alert('Share text copied — take a screenshot and post tagging @sparkle.uvpce.'); } catch(e){ prompt('Copy and post on Instagram tagging @sparkle.uvpce:', `I scored ${score} in the Catch the Sparkle mini-game!`); } } catch (err){ console.error('Share failed', err); alert('Unable to generate a shareable image. Please take a screenshot and tag @sparkle.uvpce on Instagram.'); } }

safeAdd(shareBtn, 'click', shareScreenshot, { passive:true });

/* accessibility niceties */
document.addEventListener('visibilitychange', ()=> { bgRunning = !document.hidden; if (bgRunning) requestAnimationFrame(bgLoop); });
document.addEventListener('keydown', e => { if (e.key === 'Escape'){ if (howModal && howModal.classList.contains('show')){ howModal.classList.remove('show'); document.documentElement.style.overflow=''; stopGame(true); } } });

/* initial */
document.addEventListener('DOMContentLoaded', ()=> {
  if (mainPanel){ mainPanel.style.opacity='0'; mainPanel.style.transform='translateY(8px)'; }
});
</script>
</body>
</html>

