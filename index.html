<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>SPARKLE 3.0</title>
<meta name="color-scheme" content="dark">
<meta name="description" content="Sparkle 3.0 ‚Äî Freshers' Party payment portal. Download QR and submit proof via Google Form.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sora:wght@500;700&display=swap" rel="stylesheet">

<meta name="theme-color" content="#0b0a14">
<meta property="og:title" content="Sparkle 3.0 ‚Äî Fresher √ó Farewell Celebration">
<meta property="og:type" content="website">
<meta property="og:description" content="Welcome new beginnings. Celebrate golden endings. Secure your entry & explore the Sparkle 3.0 experience.">
<meta property="og:image" content="/assets/logo.png">

<style>
  :root{
    --max:980px;
    --radius:16px;
    --muted: rgba(255,255,255,0.78);
    --panel-bg: rgba(8,6,14,0.62);
    --accentA: #9b6bff;
    --accentB: #6da6ff;
    --accentC: #7ef0f0;
    --glass: rgba(255,255,255,0.03);
    --focus: rgba(155,107,255,0.14);
  }
/* Base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:#fff;background:#06040a;-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}button{font:inherit}

/* Background */
.theme-bg{position:fixed;inset:0;background-image:url('/assets/theme.png');background-size:cover;background-position:center center;z-index:0;will-change:transform;transition:transform 300ms linear;filter:contrast(.96) saturate(1.05)}
.bg-overlay{position:fixed;inset:0;background:linear-gradient(180deg, rgba(3,2,8,0.65), rgba(6,4,10,0.78));backdrop-filter: blur(6px);z-index:1;pointer-events:none}

/* Layout */
.wrap{position:relative;z-index:2;max-width:var(--max);margin:36px auto;padding:20px}
.subtitle{color:var(--muted);font-size:clamp(12px,1.6vw,14px);margin-top:-6px}

/* -------------------- INTRO (CENTERED) -------------------- */
/* Full viewport fixed layer that centers headline + motto over canvas */
#introLayer{
  position:fixed;
  inset:0;
  z-index:60;
  pointer-events:none;
  display:flex;
  flex-direction:column;       /* stack SVG over tagline */
  align-items:center;
  justify-content:center;     /* vertical center */
  gap:18px;
  padding:24px;
  background:transparent;
}

/* canvas covers the intro layer but sits behind visual elements */
#introCanvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  display:block;
  z-index:59;                 /* keep below SVG and tagline */
}

/* intro-stage holds the SVG headline; center it and constrain size */
.intro-stage{
  position:relative;
  width:min(86vw,1000px);
  max-width:1100px;
  height:auto;                /* let SVG determine height */
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  z-index:62;                 /* above canvas */
}

/* SVG headline styling (no structural changes) */
.logo-svg{width:100%;height:auto;filter:drop-shadow(0 28px 80px rgba(80,40,160,0.28));transform-origin:center}
#logoSvg { z-index:62; pointer-events:none; display:block; }

/* Make the headline visually larger and stronger than the motto:
   - Increased SVG text size (see inline SVG attribute change below)
   - Add slight stroke for contrast on busy backgrounds */
#headline {
  paint-order: stroke fill;
  stroke: rgba(0,0,0,0.18);
  stroke-width:3px;
  filter: drop-shadow(0 10px 30px rgba(0,0,0,0.45));
}

/* Centered motto ‚Äî reduced size and pure white color (no gradient) */
.intro-title{
  font-weight:600;
  font-size: clamp(14px, 1.4vw, 15px);  /* slightly smaller than before */
  letter-spacing:0.4px;
  line-height:1.3;
  text-align:center;
  color:#ffffff;                         /* pure white as requested */
  text-shadow: 0 4px 18px rgba(0,0,0,0.45);
  transform-origin:center;
  opacity:0;                       /* revealed by existing showIntroTag() */
  transform:translateY(6px);
  transition:opacity .38s ease, transform .38s ease;
  z-index:63;                      /* keep above canvas */
  pointer-events:none;
  max-width: 90%;
  margin: 0 auto;
  padding: 0 10px;
}

/* keep a fallback .intro-tag selector for compatibility with older CSS references */
.intro-tag{display:none;}

/* -------------------- rest unchanged -------------------- */

/* Main Panel */
.logo-small{width:92px;height:92px;border-radius:14px;border:2px solid rgba(255,255,255,0.06);background:linear-gradient(90deg,var(--accentA),var(--accentB));display:block;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.panel{margin:28px auto;background:var(--panel-bg);border-radius:var(--radius);padding:20px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 80px rgba(0,0,0,0.6);backdrop-filter: blur(6px)}
.phase{
  position:relative;
  padding:10px 14px;
  border-radius:12px;
  background:rgba(255,255,255,0.02);
  color:#fff;
  border:1px solid rgba(255,255,255,0.08);
  font-weight:700;
  cursor:pointer;
  min-width:110px;
  text-align:center;
  transition:.18s ease;
}

/* active = gradient card */
.phase.active{
  background:linear-gradient(135deg,#9b6bff,#6da6ff);
  color:#07101a;
  box-shadow:0 16px 40px rgba(110,120,255,.25);
  transform:translateY(-4px);
}

/* locked = dark + dim */
.phase.locked{
  opacity:.45;
  cursor:not-allowed;
  background:rgba(255,255,255,0.03);
}

/* price text */
.phase small{
  display:block;
  font-size:12px;
  opacity:.9;
}

/* subtle hover */
.phase:hover:not(.locked){
  transform:translateY(-3px);
}
.phase .lock{
  display:block;
  font-size:16px;
  margin-top:4px;
}
.phase-row{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-bottom:8px;
  flex-wrap:nowrap;      /* force single-row layout */
  overflow-x:auto;       /* enable scroll if screen too small */
  -webkit-overflow-scrolling:touch;
}
@media(max-width:480px){
  .phase{
    min-width:96px;
    padding:8px 10px;
  }
}


/* Selected info and seat counter */
.selected{margin-top:6px;text-align:center;color:var(--muted);font-size:14px}
.seats{margin-top:6px;text-align:center;color:var(--muted);font-size:13px}


/* QR area */
.qr-area{display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:16px}
.qr-wrap{background:#fff;padding:18px;border-radius:14px;box-shadow:0 12px 36px rgba(2,6,23,0.48)}
.qr-img{width:320px;height:320px;max-width:92%;object-fit:contain;image-rendering:pixelated;border-radius:12px;display:block}
.qr-meta{font-size:14px;color:var(--muted)}

/* Actions */
.actions{display:flex;gap:12px;margin-top:8px;flex-wrap:wrap;justify-content:center}
.btn{padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:800;transition:transform .12s cubic-bezier(.2,.9,.2,1), box-shadow .12s}
.btn.primary{background:linear-gradient(90deg,var(--accentB),var(--accentA));color:#07101a;box-shadow:0 14px 36px rgba(80,100,220,0.09)}
.btn.ghost{background:linear-gradient(90deg,var(--accentB),var(--accentA));color:#07101a;box-shadow:0 14px 36px rgba(80,100,220,0.09)}
.btn.ghost[disabled]{opacity:0.46;cursor:not-allowed;}

/* About and contact ‚Äî ensure justified text */
.split{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:18px}
.about{padding:14px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
.about p{color:var(--muted);line-height:1.5;text-align:justify}
.org-card{padding:14px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
.socials{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.socials a{color:var(--muted)}

/* Enhanced Guidelines Section */
.guidelines {
  margin-top: 24px;
  padding: 20px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(155,107,255,0.2);
  border-radius: 14px;
  box-shadow: 0 4px 20px rgba(155,107,255,0.08);
}

.guidelines strong:first-child {
  display: block;
  color: #fff;
  font-size: 16px;
  margin-bottom: 12px;
  letter-spacing: 0.5px;
}

.guidelines ul {
  margin: 12px 0 0 20px;
  padding: 0;
  color: var(--muted);
  line-height: 1.8;
}

.guidelines li {
  margin-bottom: 8px;
}

.guidelines li strong {
  color: #fff;
}


/* modal */
.modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;background:rgba(0,0,0,0.7);z-index:9999;overflow-y:auto;-webkit-overflow-scrolling:touch}
.modal.show{display:flex}
.modal-card{width:92%;max-width:720px;background:#07101a;padding:20px;border-radius:12px;color:#fff;box-shadow:0 30px 80px rgba(0,0,0,0.6);margin:20px 0;max-height:90vh;overflow-y:auto}
input{
  font-size:15px;
}

@media(max-width:600px){
  .badge-title{font-size:20px}
}
@media(max-width:920px){.split{grid-template-columns:1fr}.qr-img{width:260px;height:260px}.intro-title{font-size:clamp(13px,2.4vw,15px)}}
@media(max-width:480px){.qr-img{width:200px;height:200px}.intro-stage{height:220px}.intro-title{font-size:clamp(12px,3.2vw,14px)}}
.visually-hidden{position:absolute;left:-9999px}

/* =========================
   PREMIUM SPARK HEADER
========================= */

.spark-header{
  position:sticky;
  top:0;
  z-index:80;
  background:rgba(5,4,12,.70);
  border-bottom:1px solid rgba(255,255,255,.12);
  backdrop-filter:blur(14px);
}

.spark-nav{
  max-width:980px;
  margin:0 auto;
  padding:10px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
}

/* BRAND */
.spark-brand{
  display:flex;
  align-items:center;
  gap:12px;
}

.spark-logo{
  width:54px;
  height:54px;
  border-radius:14px;
  border:2px solid rgba(255,255,255,.14);
  background:linear-gradient(90deg,#9b6bff,#6da6ff);
  box-shadow:0 10px 28px rgba(0,0,0,.55);
}

.spark-title-wrap{
  display:flex;
  flex-direction:column;
  line-height:1.15;
}

.spark-title{
  font-family:Sora,Inter;
  font-weight:900;
  letter-spacing:.6px;
  font-size:19px;
}

.spark-sub{
  color:#b9c3ff;
  font-size:12px;
  letter-spacing:.4px;
  opacity:.9;
}

/* TABS */
.spark-tabs{
  display:flex;
  gap:8px;
}

.spark-tab{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:#fff;
  cursor:pointer;
  font-weight:700;
  transition:.18s ease;
}

.spark-tab:hover{
  background:rgba(255,255,255,.12);
}

.spark-tab.active{
  background:linear-gradient(90deg,#6da6ff,#9b6bff);
  color:#07101a;
  box-shadow:0 14px 32px rgba(110,120,255,.28);
  transform:translateY(-2px);
}

/* CTA BUTTON */
.spark-cta{
  padding:10px 16px;
  border-radius:12px;
  background:linear-gradient(90deg,#9b6bff,#6da6ff);
  color:#07101a;
  font-weight:800;
  box-shadow:0 18px 38px rgba(0,0,0,.5);
  border:1px solid rgba(255,255,255,.25);
}

/* MOBILE */
@media(max-width:720px){

  .spark-nav{
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
  }

  .spark-brand{
    width:100%;
    justify-content:center;
  }

  .spark-tabs{
    width:100%;
    justify-content:center;
  }

  .spark-cta{
    width:100%;
    text-align:center;
  }

  .spark-title{
    font-size:17px;
  }

  .spark-sub{
    font-size:11px;
  }
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.brand h1{
  font-size:18px;
  margin:0;
  letter-spacing:.4px;
}

/* Panels */
.panel{
  display:none;
  animation:fadeInUp .45s ease forwards;
}

.panel.active{
  display:block;
}

/* Smooth reveal animation */
@keyframes fadeInUp{
  0%{opacity:0; transform:translateY(14px)}
  100%{opacity:1; transform:translateY(0)}
}

.result-box{
  margin-top:14px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.12);
  border-radius:12px;
  padding:14px;
}
/* === Shared Section Polishing === */
.spark-card{
  margin-top:14px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.14);
  border-radius:16px;
  padding:14px 16px;
  box-shadow:0 28px 60px rgba(0,0,0,.45);
}

/* Headline consistency */
.panel h2{
  margin-top:0;
  font-family:Sora,Inter;
  letter-spacing:.3px;
}

/* Dropdown polish */
.panel select{
  width:100%;
  margin:10px 0 14px;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  color:#fff;
  appearance:none;
  outline:none;
  font-weight:500;
}

.panel select option{
  background:#0b0a14;
  color:#fff;
}

.panel select:hover{
  border-color:#9b6bff;
}

.panel select:focus{
  border-color:#6da6ff;
  box-shadow:0 0 0 2px rgba(110,150,255,.25);
}


/* Score output meter */
.spark-meter{
  margin-top:12px;
  height:10px;
  border-radius:8px;
  background:rgba(255,255,255,.18);
}
.spark-meter-fill{
  height:10px;
  border-radius:8px;
  background:linear-gradient(90deg,#6da6ff,#9b6bff);
}

#scoreNum{
  display:inline-block;
  animation:pulse 1.5s infinite;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.12)}
  100%{transform:scale(1)}
}

#mpResult{
  display:none;
  visibility:hidden;
  opacity:0;
  transition:.25s ease;
}

#mpResult .spark-card{
  width:100%;
  box-sizing:border-box;
}

</style>
<script defer src="/_vercel/insights/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

<!-- THEME BG -->
<div id="themeBg" class="theme-bg" aria-hidden="true"></div>
<div class="bg-overlay" aria-hidden="true"></div>

<!-- INTRO LAYER (centered headline + motto over canvas) -->
<div id="introLayer">
  <canvas id="introCanvas" width="1000" height="480" aria-hidden="true"></canvas>

  <div class="intro-stage" aria-hidden="true">
    <svg id="logoSvg" class="logo-svg" viewBox="0 0 1000 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <linearGradient id="grad" x1="0" x2="1">
          <stop offset="0%" stop-color="#ffffff"/>
          <stop offset="40%" stop-color="#b084ff"/>
          <stop offset="100%" stop-color="#6da6ff"/>
        </linearGradient>
        <linearGradient id="sweep" x1="0" x2="1">
          <stop offset="0%" stop-color="#fff" stop-opacity="0"/>
          <stop offset="40%" stop-color="#fff" stop-opacity="0.24"/>
          <stop offset="70%" stop-color="#fff" stop-opacity="0.06"/>
          <stop offset="100%" stop-color="#fff" stop-opacity="0"/>
        </linearGradient>
      </defs>

      <!-- Increased font-size so headline is clearly larger than motto -->
      <text id="headline" x="50%" y="60%" text-anchor="middle" font-family="Impact, Arial Black, sans-serif" font-size="120" fill="url(#grad)" font-weight="900" style="letter-spacing:6px">
        SPARKLE 3.0
      </text>

      <rect id="sweepRect" x="-520" y="-80" width="420" height="280" fill="url(#sweep)" style="mix-blend-mode:screen;opacity:0.98"></rect>
    </svg>
  </div>

  <!-- center-styled motto; id left as introTag for JS compatibility -->
  <div id="introTag" class="intro-title">Welcoming New Beginnings,<br>Celebrating Golden Endings</div>
</div>

<!-- APP -->
<div class="wrap" id="app" aria-hidden="true" style="opacity:0;transform:translateY(12px);display:none">

  <header class="spark-header">
  <div class="spark-nav">

    <div class="spark-brand">
      <img class="spark-logo" src="/assets/logo.png" alt="Sparkle 3.0">
      <div class="spark-title-wrap">
        <div class="spark-title">Sparkle 3.0</div>
        <div class="spark-sub">Fresher‚Äôs √ó Farewell Celebration</div>
      </div>
    </div>

    <nav class="spark-tabs">
      <button class="spark-tab active" onclick="sparkleNav('mainPanel',this)">Payment</button>
      <button class="spark-tab" onclick="sparkleNav('memory',this)">Memory Probability</button>
    </nav>

    <a class="spark-cta" target="_blank" href="https://www.instagram.com/sparkle.uvpce">
      CONTACT US
    </a>

  </div>
</header>

  <section id="mainPanel" class="panel active">
    <h2 id="payHead" class="visually-hidden">Payment</h2>

    <div class="phase-row" id="phases" role="tablist" aria-label="Phases"></div>
    <div class="selected" id="selectedInfo">Selected: ‚Äî</div>
    <div class="seats" id="seatsInfo">Seats left: ‚Äî</div>

    <div class="qr-area" id="qrArea">
      <div class="qr-wrap">
        <img id="qrImg" class="qr-img" src="/assets/qr1.png" alt="Payment QR" loading="lazy">
      </div>
      <div class="qr-meta">UPI ID ‚Äî <strong id="upiId">‚Äî</strong></div>

      <div class="actions">
        <button id="downloadBtn" class="btn primary" type="button">Download QR</button> 
        <button id="howBtn" class="btn ghost" type="button">How to pay</button>
        <button id="formBtn" class="btn ghost" type="button">Google Form</button>
      </div>

      <div class="guidelines">
        <strong>‚ö†Ô∏è Important Guidelines</strong>
        <ul>
              <li><strong>Phase 2 is now officially open for All year students of UVPCE.</strong> Slots are limited and will be allotted strictly on a first-come, first-served basis.</li>
              <li><strong>Payment is required only once.</strong> Upon successful payment and correct submission of the Google Form, the registration process is complete.</li>
              <li>Please verify the payable amount before proceeding and retain a clear transaction screenshot</li>
              <li style="color:#ffd93d"><strong style="color:#ffd93d">üìã Submission of the payment screenshot and UPI transaction ID via the Google Form is mandatory.</strong></li>
              <li style="color:#ff6b6b"><strong>‚ö†Ô∏è Payments once made are strictly non-refundable under any circumstances.</strong></li>
              <li><strong>All participants will be treated equally on the event day.</strong> No partiality, preference, or special consideration will be given.</li>
              <li>For any queries or clarifications, please contact the organising committee.</li>
              <li>Thank you for your support and follow us on Instagram for updates! üéâ</li>
        </ul>
      </div>

      <div class="split">
        <div class="about">
          <h3 style="margin:0 0 10px 0">About Sparkle 3.0</h3>
          <p>
            Sparkle 3.0 is a fully student-driven celebration created to warmly welcome our newly admitted batch while also offering a heartfelt and graceful farewell to our beloved seniors. Embracing the motto ‚ÄúWelcoming New Beginnings, Celebrating Golden Endings,‚Äù the event brings together music, performances, joy and togetherness, making it a special night where new journeys begin and cherished chapters are honored with pride.
          </p>
        </div>

        <aside class="org-card" aria-labelledby="orgHead">
          <h3 id="orgHead" style="margin:0 0 8px 0">Organiser & Contact</h3>
          <div style="color:var(--muted);line-height:1.6">
            <div><strong>Organiser:</strong> Sparkle 3.0 Committee</div>
            <div><strong>Phone:</strong> <a href="tel:+911234567890">+91 8980667112</a></div>
            <div><strong>Email:</strong> <a href="mailto:contact@sparkle.example">sparkle.uvpce@gmail.com</a></div>

            <div style="margin-top:8px"><strong>Follow us:</strong></div>
            <div class="socials">
              <a href="https://www.instagram.com/sparkle.uvpce" target="_blank" rel="noopener">Instagram ‚Ä¢ @sparkle3.0</a>
              <a href="https://maps.app.goo.gl/K7aEVPNHssWAoT9R8" target="_blank" rel="noopener">Venue ‚Ä¢ Map</a>
            </div>
          </div>
        </aside>
      </div>

    </div>

  </section>
<section id="memory" class="panel">
  <h2>üß† S.P.A.R.K. Memory Index‚Ñ¢</h2>

  <div class="subtitle">
    <strong>S.P.A.R.K.</strong> stands for
    <em>‚ÄúSpark Probability & Recall Knowledge Index.‚Äù</em>
    It is a reflective probability model that estimates how strongly Sparkle 3.0 may stay with you ‚Äî emotionally and socially.
  </div>

  <div class="spark-card">

    <label>Your Current Year</label>
    <select id="mpYear">
      <option>1st Year</option>
      <option>2nd Year</option>
      <option>3rd Year</option>
      <option>Final Year</option>
    </select>

    <label>Group Size Attending With You</label>
    <select id="mpGroup">
      <option>Solo</option>
      <option>2‚Äì3 Friends</option>
      <option>4‚Äì6 Friends</option>
      <option>Large Group (7+)</option>
    </select>

    <label>How Often You Meet These Friends</label>
    <select id="mpFreq">
      <option>Daily</option>
      <option>Few times a week</option>
      <option>Rarely</option>
      <option>Hardly ever</option>
    </select>

    <label>Your Emotional Investment</label>
    <select id="mpEmotion">
      <option>Very High</option>
      <option>Moderate</option>
      <option>Unsure</option>
      <option>Low</option>
    </select>

    <label>Time Left In Your Degree</label>
    <select id="mpTime">
      <option>Just Started</option>
      <option>Midway</option>
      <option>Almost There</option>
      <option>Last Phase</option>
    </select>

    <button id="generateIndexBtn" class="btn primary" type="button">Generate Index</button>


  </div>

  <div id="mpResult" class="result-box" style="display:none"></div>

</section>

  <footer style="margin-top:18px;text-align:center;color:var(--muted)">¬© Sparkle 3.0 2026</footer>
</div>

<!-- How to pay modal -->
<div id="howModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="howTitle">
  <div class="modal-card" role="document">
    <h2 id="howTitle" style="margin:0 0 10px 0;font-size:20px">How to pay ‚Äî step-by-step</h2>
    <p style="color:var(--muted);margin:0 0 10px 0;font-size:14px">Follow these exact steps for reliable payment and proof submission (Android & iPhone).</p>

    <ol style="margin:10px 0 0 0;padding-left:20px;color:var(--muted);line-height:1.6">
      <li><strong>Download the QR</strong> by tapping <em>Download QR</em>. Save the image to your phone (Photos/Gallery). Do not edit the file.</li>
      <li style="margin-top:8px"><strong>Open a UPI app</strong> ‚Äî Google Pay / PhonePe / Paytm / BHIM or bank UPI app.
        <ul style="margin-top:6px;color:var(--muted)">
          <li><strong>Android:</strong> Choose "Scan QR" ‚Üí "Select from gallery" (icon may vary). Pick the saved image.</li>
          <li><strong>iPhone / iOS:</strong> If app supports choosing from Photos, use that. Otherwise display the QR on another device and scan with the app camera.</li>
        </ul>
      </li>
      <li style="margin-top:8px"><strong>Confirm pay details</strong>
        <div style="color:var(--muted);margin-top:6px">
          Confirm payee name / UPI ID and the <em>exact amount</em> for the selected phase before confirming the transaction.
        </div>
      </li>
      <li style="margin-top:8px"><strong>Capture proof</strong>
        <div style="color:var(--muted);margin-top:6px">
          After payment, take a clear screenshot showing UPI ID, amount, transaction ID and timestamp. This screenshot is mandatory for verification.
        </div>
      </li>
      <li style="margin-top:8px"><strong>Submit proof</strong>
        <div style="color:var(--muted);margin-top:6px">
          Return to this page and click <em>Google Form</em>. Upload the screenshot and enter the transaction ID exactly.
        </div>
      </li>
      <li style="margin-top:8px"><strong>Fraud policy ‚Äî strict action</strong>
        <div style="color:#ffb3b3;margin-top:6px">
          Uploading forged or manipulated payment screenshots is strictly prohibited. If the organisers detect a fake or tampered screenshot, the offender's submission will be rejected and the organising committee reserves the right to take strict action, including disqualification from the event and reporting to institutional authorities. Submit only genuine payment proofs.
        </div>
      </li>
      <li style="margin-top:8px"><strong>Troubleshooting</strong>
        <div style="color:var(--muted);margin-top:6px">
          If the app doesn't allow selecting gallery images, scan the QR from another device or print the QR temporarily. Avoid in-app browsers; use Chrome or Safari.
        </div>
      </li>
    </ol>

    <div style="text-align:right;margin-top:20px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.1)">
      <button id="closeHow" class="btn primary" type="button" style="padding:10px 20px;font-size:15px">Understood</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
/* ==================== CONFIG ‚Äî edit capacities & amounts here ====================
   Change `capacity` values to update seats; -1 means unlimited/remaining.
============================================================================== */
const CONFIG = {
  phases: [
    { key:'phase1', label:'Phase 1', amount:200, capacity:12},
    { key:'phase2', label:'Phase 2', amount:250, capacity:185},
    { key:'phase3', label:'Phase 3', amount:300, capacity:-1 }
  ],
  activePhaseIndex: 1,
  qr: { img: '/assets/qr1.png', img2x: null, upiId: 'paytm.s206qns@pty' },
  googleFormLink: 'https://forms.gle/sUVh4PZMpdyXnjDAA'
};
/* ================================================================================= */

/* ---------- DOM refs (shared) ---------- */
const phasesEl = document.getElementById('phases');
const selectedInfo = document.getElementById('selectedInfo');
const seatsInfo = document.getElementById('seatsInfo');
const qrImg = document.getElementById('qrImg');
const upiIdEl = document.getElementById('upiId');
const downloadBtn = document.getElementById('downloadBtn');
const howBtn = document.getElementById('howBtn');
const formBtn = document.getElementById('formBtn');
const howModal = document.getElementById('howModal');
const closeHow = document.getElementById('closeHow');
const sweepRect = document.getElementById('sweepRect');
const introLayer = document.getElementById('introLayer');
const introCanvas = document.getElementById('introCanvas');
const appWrap = document.getElementById('app');

/* ---------- Phase rendering & QR --------- */
function renderPhases(){
  phasesEl.innerHTML = '';
  CONFIG.phases.forEach((p,i)=>{
  const btn=document.createElement("button");
  const isActive=(i===CONFIG.activePhaseIndex);

  btn.className="phase"+(isActive?" active":" locked");
  btn.type="button";

  btn.innerHTML = `
    ${p.label}
    <small>‚Çπ${p.amount}</small>
  `;

  if(!isActive){
    btn.disabled=true;
    btn.innerHTML+=`<span class="lock">üîí</span>`;
  }

  if(isActive){
    btn.addEventListener("click",()=>{
      CONFIG.activePhaseIndex=i;
      updateSelected();
      renderPhases();
    })
  }

  phasesEl.appendChild(btn);
});

  updateSelected();
}


function updateSelected(){
  const p = CONFIG.phases[CONFIG.activePhaseIndex];
  selectedInfo.textContent = `${p.label}: ‚Çπ${p.amount}`;
  let seatsText;
  if (p.capacity === -1) seatsText = 'Seats: Remaining / open';
  else if (p.capacity === 0) seatsText = 'Seats: Full';
  else seatsText = `Seats left: ${p.capacity}`;
  seatsInfo.textContent = seatsText;
}

function renderQr(){
  if (CONFIG.qr.img2x) qrImg.srcset = `${CONFIG.qr.img} 1x, ${CONFIG.qr.img2x} 2x`;
  qrImg.src = CONFIG.qr.img;
  upiIdEl.textContent = CONFIG.qr.upiId || '';
}

function downloadQrImage(){
  const src = qrImg.src || CONFIG.qr.img;
  if (!src) return alert('QR image not configured');
  fetch(src, { mode: 'cors' }).then(resp => {
    if (!resp.ok) throw new Error('Image fetch failed');
    return resp.blob();
  }).then(blob => {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `sparkle_qr_${CONFIG.phases[CONFIG.activePhaseIndex].label.replace(/\s+/g,'')}.png`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  }).catch(()=> {
    window.open(src, '_blank', 'noopener');
    alert('Automatic download blocked ‚Äî the QR image was opened in a new tab. Save it from there (long-press on mobile).');
  });
}

function openGoogleForm(){
  if (!CONFIG.googleFormLink) return alert('Google Form link not configured');
  window.open(CONFIG.googleFormLink, '_blank', 'noopener');
}

/* How modal handlers */
howBtn.addEventListener('click', ()=> howModal.classList.add('show'));
closeHow.addEventListener('click', ()=> howModal.classList.remove('show'));
howModal.addEventListener('click', (e)=> { if (e.target === howModal) howModal.classList.remove('show'); });

downloadBtn.addEventListener('click', downloadQrImage);
formBtn.addEventListener('click', openGoogleForm);

/* --------- INTRO ANIMATION (canvas particles + sweep) --------- */
let ctx = null;
let DPR = Math.max(1, window.devicePixelRatio || 1);
let particles = [];
let running = true;
let introVisible = true;
let lastFrame = performance.now();
let rafId = null;

function resizeCanvas(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  const rect = introCanvas.getBoundingClientRect();
  const w = Math.max(300, Math.floor(rect.width));
  const h = Math.max(200, Math.floor(rect.height));
  if (introCanvas.width !== Math.floor(w * DPR) || introCanvas.height !== Math.floor(h * DPR)) {
    introCanvas.width = Math.floor(w * DPR);
    introCanvas.height = Math.floor(h * DPR);
  }
  if (ctx) ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}

function initCanvas(){
  ctx = introCanvas.getContext('2d', { alpha: true });
  resizeCanvas();
}

function createParticles(){
  particles = [];
  const width = introCanvas.width / DPR;
  let N = Math.max(10, Math.floor(width / 60));
  if (DPR < 1.5) N = Math.max(8, Math.floor(N * 0.9));
  if (/Mobi|Android/i.test(navigator.userAgent)) N = Math.min(N, 36);
  for (let i=0;i<N;i++){
    particles.push({
      x: Math.random() * width,
      y: introCanvas.height / DPR + Math.random() * 220,
      vx: (Math.random() - 0.5) * 0.6,
      vy: - (0.8 + Math.random() * 1.6),
      r: 1 + Math.random() * 6,
      life: 120 + Math.random() * 200,
      hue: 240 + Math.random() * 90
    });
  }
}

function particleLoop(now){
  if (!running || !introVisible) return;
  const dt = Math.min(40, now - lastFrame);
  lastFrame = now;
  const width = introCanvas.width / DPR;
  const height = introCanvas.height / DPR;
  ctx.clearRect(0,0,width,height);

  for (let i=0;i<particles.length;i++){
    const p = particles[i];
    p.x += p.vx * dt;
    p.y += p.vy * dt;
    p.life -= dt * 0.12;
    if (p.life <= 0 || p.y < -80) {
      p.x = Math.random() * width;
      p.y = height + 10 + Math.random() * 120;
      p.vx = (Math.random() - 0.5) * 0.6;
      p.vy = - (0.8 + Math.random() * 1.6);
      p.r = 1 + Math.random() * 6;
      p.life = 120 + Math.random() * 200;
      p.hue = 240 + Math.random() * 90;
    }
    const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 12);
    g.addColorStop(0, `hsla(${p.hue},95%,70%,0.95)`);
    g.addColorStop(0.25, `hsla(${p.hue},95%,70%,0.36)`);
    g.addColorStop(1, `hsla(${p.hue},95%,70%,0)`);
    ctx.fillStyle = g;
    ctx.fillRect(Math.round(p.x - p.r * 6), Math.round(p.y - p.r * 6), p.r * 12, p.r * 12);
  }
}

function animateSweep(duration = 3200, startX = -520, endX = 1320){
  const start = performance.now();
  function frame(now){
    const t = Math.min(1, (now - start) / duration);
    const eased = 1 - Math.pow(1 - t, 3);
    const x = startX + (endX - startX) * eased;
    if (sweepRect) sweepRect.setAttribute('x', String(x));
    if (t < 1) requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}


function runIntro(){
  if (!ctx) initCanvas();
  resizeCanvas();
  createParticles();
  animateSweep(3200, -520, 1320);
  lastFrame = performance.now();

  function loop(now){
    if (!introVisible) return;
    particleLoop(now);
    rafId = requestAnimationFrame(loop);
  }
  rafId = requestAnimationFrame(loop);

  const total = 3200 + 650;
  setTimeout(() => {
    introLayer.style.transition = 'opacity .48s ease';
    introLayer.style.opacity = '0';
    setTimeout(() => {
      introVisible = false;
      if (rafId) cancelAnimationFrame(rafId);
      ctx && ctx.clearRect(0,0,introCanvas.width,introCanvas.height);
      introLayer.style.display = 'none';
      revealMain();
    }, 480);
  }, total);
}


function sparkleNav(id, btn){

  // switch content panels
  document.querySelectorAll('.panel').forEach(p=>{
    p.classList.remove('active');
  });

  const target = document.getElementById(id);
  if(target){
    target.classList.add('active');
  }

  // update tab highlight
  document.querySelectorAll('.spark-tab').forEach(t=>{
    t.classList.remove('active');
  });

  if(btn){
    btn.classList.add('active');
  }

  // always reset scroll
  window.scrollTo({top:0, behavior:'smooth'});
}


function showIntroTag(){
  const t = document.getElementById('introTag');
  if (!t) return;
  t.style.opacity = '1';
  t.style.transform = 'translateY(0)';
}

function revealMain(){
  appWrap.style.display="block";
  appWrap.removeAttribute("aria-hidden");

  renderPhases();
  renderQr();
  updateSelected();

  requestAnimationFrame(()=>{
    appWrap.style.opacity="1";
    appWrap.style.transform="translateY(0)";
  });

  // ‚≠ê show Astra widget shell (hidden until opened)
  const astra = document.getElementById("astraWidget");
  if(astra){
    astra.style.display = "block";
  }

  // ‚≠ê show launcher button now
  const launcher = document.getElementById("astraLauncher");
  if(launcher){
    launcher.style.display = "flex";
  }

  // ‚≠ê popup welcome peek
  showPeek();
}


/* ---------- background parallax (mouse + touch) ---------- */
(function backgroundParallax(){
  const bg = document.getElementById('themeBg');
  if (!bg) return;
  let lastX = 0, lastY = 0;
  let tick = null;
  function updateTransform(x, y){
    lastX += (x - lastX) * 0.06;
    lastY += (y - lastY) * 0.06;
    bg.style.transform = `translate3d(${lastX}px, ${lastY}px, 0) scale(1.02)`;
  }
  function onMove(e){
    const w = window.innerWidth, h = window.innerHeight;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const x = (clientX / w - 0.5) * 22;
    const y = (clientY / h - 0.5) * 12;
    if (tick === null) {
      tick = requestAnimationFrame(()=> { updateTransform(x,y); tick = null; });
    }
  }
  window.addEventListener('mousemove', onMove, { passive: true });
  window.addEventListener('touchmove', onMove, { passive: true });
})();

/* ---------- visibility & resize handling ---------- */
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    running = false; 
    if (rafId) cancelAnimationFrame(rafId);
  } else {
    running = true;
    if (introVisible) { 
      lastFrame = performance.now(); 
      rafId = requestAnimationFrame(function resume(now) { 
        particleLoop(now); 
        rafId = requestAnimationFrame(resume); 
      }); 
    }
  }
});

let resizeTimer = null;
function onResize(){
  resizeCanvas();
  if (introVisible) createParticles();
  if (resizeTimer) clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => { 
    resizeCanvas(); 
    if (introVisible) createParticles(); 
  }, 120);
}
window.addEventListener('resize', onResize, { passive: true });

// Initialize the page when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
  // Start the intro animation
  runIntro();
  
  // Show the intro tag after a short delay
  setTimeout(showIntroTag, 800);
});
function calcMemory(){

  let score = 50;

  const year = document.getElementById('mpYear').value;
  const group = document.getElementById('mpGroup').value;
  const freq = document.getElementById('mpFreq').value;
  const emo  = document.getElementById('mpEmotion').value;
  const time = document.getElementById('mpTime').value;

  // Year weighting
  if(year === "Final Year") score += 28;
  else if(year === "3rd Year") score += 16;
  else if(year === "2nd Year") score += 10;

  // Group influence
  if(group === "Large Group (7+)") score += 18;
  else if(group === "4‚Äì6 Friends") score += 12;
  else if(group === "2‚Äì3 Friends") score += 8;

  // Meeting frequency
  if(freq === "Rarely") score += 12;
  if(freq === "Hardly ever") score += 18;

  // Emotion
  if(emo === "Very High") score += 20;
  else if(emo === "Moderate") score += 10;
  else if(emo === "Low") score -= 12;

  // Time remaining
  if(time === "Last Phase") score += 16;
  if(time === "Almost There") score += 10;

  // Normalise
  if(score > 100) score = 100;
  if(score < 28) score = 28;

  let tone =
    (score >= 85) ? "there is a very high likelihood that Sparkle 3.0 becomes a defining memory associated with your time here." :
    (score >= 70) ? "Sparkle 3.0 is likely to be remembered as one of the warmer highlights of your university journey." :
    "this evening may become a gentle memory that you look back on with quiet nostalgia.";

  const supporting =
    "Students with similar profiles often describe this evening as one of their most meaningful social experiences.";

  const box = document.getElementById('mpResult');

  // ‚≠ê ALWAYS FORCE SHOW
  box.style.display = "block";
  box.style.visibility = "visible";
  box.style.opacity = "1";

  // ‚≠ê ENSURE HEIGHT EXPANDS
  box.style.maxHeight = "none";

  // ‚≠ê WRITE CONTENT
  box.innerHTML = `
    <div class="spark-card">

      <div style="font-size:20px;font-weight:800">
        S.P.A.R.K. Memory Index‚Ñ¢: <span id="scoreNum">${score}%</span>
      </div>

      <div class="spark-meter">
        <div class="spark-meter-fill" style="width:${score}%"></div>
      </div>

      <div style="margin-top:12px;color:var(--muted)">
        Based on your current phase in university life, ${tone}
      </div>

      <div style="margin-top:12px;color:#bfc3ff">
        ${supporting}
      </div>

      <div style="margin-top:10px;font-size:12px;color:#9ea7ff">
        <strong>S.P.A.R.K.</strong> = Spark Probability & Recall Knowledge Index
      </div>

    </div>
  `;

  // ‚≠ê MOST IMPORTANT FOR MOBILE
  box.scrollIntoView({ behavior:"smooth", block:"center" });
}

document.addEventListener("DOMContentLoaded", function(){

  const genBtn = document.getElementById("generateIndexBtn");

  if(genBtn){
    genBtn.addEventListener("click", function(e){
      e.preventDefault();
      e.stopPropagation();
      calcMemory();
    });
  }

});

</script>
<!-- SPARK COMPANION ‚Äî ASTRA -->
<div id="astraWidget">
  <div id="astraHeader">Astra (Sparkle 3.0 Companion)<span id="astraClose" style="float:right;cursor:pointer">√ó</span></div>
  <div id="astraChat"></div>
  <div id="astraPrompts">
    <button>How do I pay?</button>
    <button>Where is the event?</button>
    <button>I feel nervous going alone</button>
  </div>


  <div id="astraInputBox">
    <input id="astraInput" placeholder="Type your message..." />
    <button id="astraSend">Send</button>
  </div>
</div>

<div id="astraLauncher">
  ‚ú®
</div>

<div id="astraPeek">
  Hi ‚Äî I‚Äôm Astra. Here if you need me.
</div>


<style>
#astraWidget{
  position:fixed;
  bottom:82px;
  right:18px;
  width:320px;
  max-width:92vw;
  max-height:70vh;
  border-radius:16px;
  background:rgba(11,10,20,.9);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 28px 80px rgba(0,0,0,.6);
  font-family:Inter,system-ui;
  color:#fff;
  overflow:hidden;
  backdrop-filter:blur(12px);
  z-index:99999;
  display:none;
  opacity:0;
  transform:translateY(8px);
  transition:.25s ease;
}

/* when visible */
#astraWidget.open{
  display:block;
  opacity:1;
  transform:translateY(0);
}

#astraHeader{
  padding:12px 14px;
  font-weight:800;
  background:linear-gradient(90deg,#9b6bff,#6da6ff);
  color:#07101a;
  text-align:center;
}

#astraChat{
  height:280px;
  max-height:48vh;
  padding:14px;
  overflow-y:auto;
  font-size:14px;
  -webkit-overflow-scrolling:touch;
}

.msg{
  margin-bottom:10px;
  line-height:1.5;
}

.user{
  text-align:right;
  color:#bcd3ff;
}

.bot{
  color:#fff;
}

#astraInputBox{
  display:flex;
  border-top:1px solid rgba(255,255,255,.12);
}

#astraInput{
  flex:1;
  padding:10px;
  background:transparent;
  border:none;
  color:#fff;
  outline:none;
}

#astraPrompts{
  padding:10px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}

#astraPrompts button{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.18);
  padding:6px 10px;
  border-radius:10px;
  color:#fff;
  cursor:pointer;
  font-size:12px;
}

#astraSend{
  background:linear-gradient(90deg,#6da6ff,#9b6bff);
  border:none;
  color:#07101a;
  padding:10px 16px;
  cursor:pointer;
  font-weight:800;
}
#astraPeek{
  position:fixed;
  bottom:92px;                 /* sits above launcher */
  right:18px;
  transform:translateX(50%);   /* anchor to right edge */
  background:rgba(11,10,20,.92);
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  padding:12px 14px;
  max-width:240px;
  font-size:14px;
  line-height:1.45;
  box-shadow:0 18px 48px rgba(0,0,0,.55);
  backdrop-filter:blur(10px);
  z-index:99999;
  opacity:0;
  pointer-events:none;
  transition:.15s ease;
  pointer-events:none;
}

/* show state */
#astraPeek.show{
  opacity:1;
  transform:translateY(0);
  pointer-events:auto;
}

@media(max-width:680px){
  #astraPeek{
    right:18px;
    left:auto;
    bottom:92px;
    transform:translateX(50%);
    max-width:220px;
  }
}

#astraLauncher{
  position:fixed;
  bottom:18px;
  right:18px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:linear-gradient(90deg,#9b6bff,#6da6ff);
  box-shadow:0 18px 48px rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  cursor:pointer;
  z-index:99999;
  display:none;
}

@media(max-width:680px){
  #astraWidget{
    right:10px;
    left:10px;
    bottom:76px;
    width:auto;
  }
}

  #astraChat{
    height:240px;
  }
  

</style>

<script>
// =====================================
//   SPARK COMPANION ‚Äî ASTRA ENGINE
//   No APIs. No LLMs. Pure logic.
// =====================================

const chat = document.getElementById("astraChat");
const input = document.getElementById("astraInput");
const send = document.getElementById("astraSend");

let persona = {
  name:"Astra",
  mood:"warm",
  userName:null,
  year:null,
  visits: Number(localStorage.getItem("sparkVisits")||0)+1
};

localStorage.setItem("sparkVisits", persona.visits);

// ------- UTIL --------
function addMsg(text, who="bot"){
  const div = document.createElement("div");
  div.className = "msg "+who;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

document.querySelectorAll("#astraPrompts button").forEach(btn=>{
  btn.onclick = ()=>{
    const text = btn.innerText;
    addMsg(text,"user");
    setTimeout(()=> addMsg(reply(text),"bot"),300);
  };
});

function detectIntent(msg){

  msg = msg.toLowerCase();

  if(/\b(hi|hello|hey|hola|yo|sup)\b/.test(msg))
    return "greet";

  if(msg.includes("pay") || msg.includes("payment") || msg.includes("upi") || msg.includes("fees"))
    return "payment";

  if(msg.includes("venue") || msg.includes("where") || msg.includes("location") || msg.includes("oat"))
    return "venue";

  if(msg.includes("time") || msg.includes("timing") || msg.includes("clock") || msg.includes("when does it"))
    return "timing";

  if(msg.includes("dress") || msg.includes("code") || msg.includes("clothes") || msg.includes("wear"))
    return "dress";

  if(msg.includes("pass") || msg.includes("passes") || msg.includes("distribution"))
    return "passes";

  if(msg.includes("date") || msg.includes("30") || msg.includes("jan"))
    return "date";

  if(msg.includes("help") || msg.includes("confused") || msg.includes("doubt") || msg.includes("problem"))
    return "help";

  if(msg.includes("bye") || msg.includes("goodnight") || msg.includes("see you"))
    return "bye";

  if(msg.includes("friend") || msg.includes("people") || msg.includes("fun") || msg.includes("enjoy"))
    return "social";

  return "unknown";
}

// ------- EMOTION ENGINE -------
function detectEmotion(msg){
  msg = msg.toLowerCase();
  if(msg.includes("nervous")||msg.includes("scared")||msg.includes("anxious")) return "reassure";
  if(msg.includes("excited")||msg.includes("happy")) return "excited";
  if(msg.includes("sad")) return "soft";
  return "neutral";
}

function detectYear(msg){

  const m = msg.toLowerCase();

  if(m.includes("1st") || m.includes("first") || m.includes("fresh") || m.includes("fresher")){
    persona.year = "1st Year";
    return "Got it, so you‚Äôre in your 1st year. Welcome to the beginning of everything üôÇ";
  }

  if(m.includes("2nd") || m.includes("second")){
    persona.year = "2nd Year";
    return "Nice, so in 2nd year usually feels more confident and free.";
  }

  if(m.includes("3rd") || m.includes("third")){
    persona.year = "3rd Year";
    return "3rd year energy says that experienced but still playful. I like it.";
  }

  if(m.includes("final") || m.includes("last")){
    persona.year = "Final Year";
    return "Final year hits differently. This night may mean more than you realise.";
  }

  return null;
}

// ------- SEND HANDLER -------
send.onclick = ()=>{
  const msg = input.value.trim();
  if(!msg) return;

  addMsg(msg,"user");
  input.value="";

  setTimeout(()=>{
    addMsg("Astra is typing...","bot");
  },200);

  setTimeout(()=>{
    chat.lastChild.remove();
    addMsg(reply(msg),"bot");
  },900);
};

function reply(msg){

  const e = detectEmotion(msg);
  const intent = detectIntent(msg);
  const text = msg.trim();

  // -------- NAME CAPTURE --------
  if(!persona.userName && text.length <= 20 && text.split(" ").length <= 3){
    persona.userName = text;
    return `Nice to meet you, ${persona.userName}. I‚Äôm Astra, your Sparkle 3.0 Companion.`;
  }

  // -------- YEAR CAPTURE --------
  const yearReply = detectYear(text);
  if(yearReply) return yearReply;

  // -------- INTENT LOGIC --------
  switch(intent){

    case "greet":
      return "Hello üëã, I‚Äôm Astra. Ask me anything about Sparkle 3.0. Engineering brain or not, I‚Äôll answer üòÑ";

    case "payment":
      return "Payment is simple:\n\n1Ô∏è‚É£ Download QR\n2Ô∏è‚É£ Pay via any UPI app\n3Ô∏è‚É£ Upload screenshot in the Google Form\n\nIf needed, I can guide you slowly like your favourite lab assistant üôÇ";

    case "venue":
      return "üìç The venue is Open Air Theatre (OAT), Ganpat University.\n\nYes, the legendary OAT where emotions echo better than speakers üòÑ";

    case "timing":
      return "‚è∞ Event timing:\n5:00 PM to 9:00 PM\n\nCome on time, engineers are rarely early, so be the exception.";

    case "dress":
      return "üëó Dress-code:\nRuko Zara Sabar Karo\n\nHero, villain, side-character yaha sab chalta hai. Just don‚Äôt come as Error 404: Outfit Not Found üòâ";

    case "passes":
      return "üéüÔ∏è Pass distribution might starts after 19 January 2026.\n\nSo chill,no FOMO till then üòå";

    case "date":
      return "üìÖ Event Date:\n30 January 2026\n\nMark calendar. Set reminder. Tell friends. Cancel boring plans.";

    case "help":
      return "Just type normally, I understand engineering English, Gujarati English, and even broken exam-week English üôÇ";

    case "social":
      return "Many students come with friends and many come alone. But everyone leaves with memories. Matlab sabka placement yahan pakka üòÑ";

    case "bye":
      return "Okay üôÇ I‚Äôll be here when you return. Like a background app consuming zero battery üí´";
  }

  // -------- EMOTION RESPONSES --------
  if(e === "reassure")
    return "It‚Äôs okay to feel that way. First year, last year, coder, mech; everyone fits here üôÇ";

  if(e === "excited")
    return "I love that energy ‚ö° Nights like this usually become core-memory material.";

  if(e === "soft")
    return "Thank you for sharing. You‚Äôre not alone and I‚Äôm right here with you.";

  // -------- FUN UNKNOWN RESPONSE (Gujarati-friendly humour) --------
  return "I am honestly confused what you are trying to say üòÑ\n\nEngineer ho na? Kabhi kabhi keyboard bhi emotional ho jaata hoga.Try asking again in simple way. I‚Äôll reply properly üëç";
}

// ------- GREET ON LOAD -------
setTimeout(()=>{
  if(persona.visits>1)
    addMsg("Welcome back. I‚Äôm glad you returned.");
  else
    addMsg("Hi,I‚Äôm Astra. I‚Äôm here to make Sparkle feel a little more human.");

},700);

const launcher = document.getElementById("astraLauncher");
const widget = document.getElementById("astraWidget");
const closeBtn = document.getElementById("astraClose");

launcher.onclick = ()=>{
  widget.classList.add("open");
};

closeBtn.onclick = ()=>{
  widget.classList.remove("open");
};

const peek = document.getElementById("astraPeek");

function showPeek(){
  if(!peek) return;
  peek.classList.add("show");

  // auto hide after 5 seconds
  setTimeout(()=>{
    peek.classList.remove("show");
  },5000);
}

// If user clicks popup ‚Üí open chat
peek.onclick = ()=>{
  widget.classList.add("open");
  peek.classList.remove("show");
};

</script>

</body>
</html>
